<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Teszt Oldal</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÑ</text></svg>">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: white;
            font-family: Arial, sans-serif;
        }
        .navbar {
            background-color: #f8f8f8;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        .navbar a {
            margin: 0 15px;
            text-decoration: none;
            color: black;
        }
        .page {
            display: none;
            padding: 20px;
        }
        .page.active {
            display: block;
        }
        .popup-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f8f8f8;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .popup-container.active {
            display: block;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="#fooldal" onclick="showPage('fooldal')">F≈ëoldal</a>
        <a href="#kezel√©sek" onclick="showPage('kezel√©sek')">Kezel√©sek</a>
        <a href="#implantatumok" onclick="showPage('implantatumok')">Implant√°tumok</a>
    </div>
    <div id="fooldal" class="page active">
        <h1>Teszt Oldal</h1>
        <p>√ân vagyok a f≈ëoldal</p>
    </div>
    <div id="kezel√©sek" class="page">
        <h1>Kezel√©sek</h1>
        <p>Itt megismerheted a kezel√©seinket</p>
    </div>
    <div id="implantatumok" class="page">
        <h1>Implant√°tumok</h1>
        <p>Itt megismerheted implant√°tumainkat</p>
    </div>

    <div id="launcherPopup" class="popup-container">
        <span class="close-btn" onclick="closePopup()">√ó</span>
        <h2>Gomb megtal√°lva</h2>
    </div>

    <script>
        // Glob√°lis v√°ltoz√≥ a MutationObserver t√°rol√°s√°hoz
        let messageObserver = null;

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.location.hash = pageId;
        }
        const initialPageId = window.location.hash.slice(1) || 'fooldal';
        showPage(initialPageId);

        function showPopup() {
            console.log('Popup megjelenik');
            document.getElementById('launcherPopup').classList.add('active');
        }

        function closePopup() {
            document.getElementById('launcherPopup').classList.remove('active');
        }

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const voiceflowChat = document.querySelector('#voiceflow-chat');

                if (voiceflowChat) {
                    console.log('voiceflow-chat megtal√°lva');

                    const shadowRoot = voiceflowChat.shadowRoot;
                    if (shadowRoot) {
                        console.log('shadow dom megtal√°lva');

                        const launcherButton = shadowRoot.querySelector('.vfrc-launcher');
                        if (launcherButton) {
                            console.log('gomb megtal√°lva');
                            addEventListenerToLauncher(launcherButton);
                        } else {
                            const observer = new MutationObserver(function() {
                                const launcherButton = shadowRoot.querySelector('.vfrc-launcher');
                                if (launcherButton) {
                                    console.log('gomb megtal√°lva');
                                    addEventListenerToLauncher(launcherButton);
                                    observer.disconnect();
                                }
                            });

                            observer.observe(shadowRoot, {
                                childList: true,
                                subtree: true
                            });
                        }

                        // √úzenetfigyel√©s be√°ll√≠t√°sa
                        const messageContainer = shadowRoot.querySelector('div, section, [class*="message"], [class*="chat"], [class*="conversation"]') || shadowRoot;
                        if (messageContainer) {
                            console.log('√úzenet kont√©ner megtal√°lva a Shadow DOM-ban');
                            
                            // El≈ësz√∂r ellen≈ërizz√ºk, hogy van-e m√°r az √ºzenet
                            if (!searchForTimeConfirmationMessage(messageContainer)) {
                                // Ha m√©g nincs, akkor figyelj√ºk a v√°ltoz√°sokat
                                messageObserver = new MutationObserver((mutations) => {
                                    mutations.forEach((mutation) => {
                                        if (mutation.addedNodes.length) {
                                            mutation.addedNodes.forEach((node) => {
                                                if (node.nodeType === Node.ELEMENT_NODE) {
                                                    if (searchForTimeConfirmationMessage(node)) {
                                                        return;
                                                    }
                                                    const childElements = node.querySelectorAll('*');
                                                    for (const child of childElements) {
                                                        if (searchForTimeConfirmationMessage(child)) {
                                                            return;
                                                        }
                                                    }
                                                }
                                            });
                                        }
                                        if (mutation.type === 'characterData' || mutation.type === 'attributes') {
                                            const target = mutation.target;
                                            if (target.nodeType === Node.ELEMENT_NODE) {
                                                searchForTimeConfirmationMessage(target);
                                            }
                                        }
                                    });
                                });

                                messageObserver.observe(messageContainer, {
                                    childList: true,
                                    subtree: true,
                                    characterData: true,
                                    attributes: true
                                });

                                console.log('√úzenet megfigyel≈ë be√°ll√≠tva');
                            }
                        }
                    }
                }
            }, 2000);
        });

        function addEventListenerToLauncher(launcherButton) {
            launcherButton.addEventListener('click', function() {
                console.log('gombra kattint√°s t√∂rt√©nt');
                showPopup();
            });
        }

        function searchForTimeConfirmationMessage(element) {
            const targetMessage = "Sikeresen lefoglaltam az id≈ëpontot, a doktor √∫r v√°rni fogja √ñnt, amelyr≈ël e-mail meger≈ës√≠t√©st is fog kapni! üéâ";
            const elementText = element.innerText || element.textContent;
            if (elementText && elementText.includes(targetMessage)) {
                console.log('Id≈ëpontfoglal√°s meger≈ës√≠t≈ë √ºzenet megtal√°lva!');
                handleAppointmentConfirmation();
                return true;
            }

            const childNodes = element.childNodes;
            for (let i = 0; i < childNodes.length; i++) {
                const child = childNodes[i];
                if (child.nodeType === Node.TEXT_NODE) {
                    if (child.textContent && child.textContent.includes(targetMessage)) {
                        console.log('Id≈ëpontfoglal√°s meger≈ës√≠t≈ë √ºzenet megtal√°lva sz√∂vegben!');
                        handleAppointmentConfirmation();
                        return true;
                    }
                }
            }

            return false;
        }

        function handleAppointmentConfirmation() {
            console.log('Id≈ëpontfoglal√°s sikeres volt!');
            
            // Le√°ll√≠tjuk a megfigyel√©st
            if (messageObserver) {
                messageObserver.disconnect();
                messageObserver = null;
                console.log('√úzenetfigyel≈ë le√°ll√≠tva');
            }
            
            // Itt lehet b√°rmilyen tov√°bbi akci√≥
        }
    </script>

    <script type="text/javascript">
        (function(d, t) {
            var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
            v.onload = function() {
                window.voiceflow.chat.load({
                    verify: { projectID: '67ffb52d503fdd626caa0ded' },
                    url: 'https://general-runtime.voiceflow.com',
                    versionID: 'production',
                    voice: {
                        url: "https://runtime-api.voiceflow.com"
                    }
                });
            };
            v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; 
            v.type = "text/javascript"; 
            s.parentNode.insertBefore(v, s);
        })(document, 'script');
    </script>
</body>
</html>
